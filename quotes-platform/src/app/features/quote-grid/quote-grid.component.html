<div class="quote-grid-container">
  @if (isLoading()) {
    <div class="loading-state">
      <div class="loading-spinner"></div>
      <p class="loading-text">Đang tải câu trích dẫn...</p>
    </div>
  } @else {
    <!-- Header with Search -->
    <div class="grid-header">
      <div class="header-title">
        <h2>Khám Phá Trích Dẫn</h2>
        <p class="subtitle" data-testid="result-count">{{ filteredQuotes().length }} câu trích dẫn</p>
      </div>
      
      <!-- Filter Controls -->
      <div class="filter-controls" data-testid="filter-controls">
        <!-- Display Count Dropdown -->
        <div class="filter-group">
          <label for="displayCount" class="filter-label">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <rect x="3" y="3" width="14" height="3" rx="1" fill="currentColor"/>
              <rect x="3" y="8" width="14" height="3" rx="1" fill="currentColor"/>
              <rect x="3" y="13" width="14" height="3" rx="1" fill="currentColor"/>
            </svg>
            Hiển thị
          </label>
          <select 
            id="displayCount"
            class="filter-select"
            data-testid="display-count"
            [ngModel]="displayCount()"
            (ngModelChange)="onDisplayCountChange($event)"
            aria-label="Số lượng câu trích dẫn hiển thị">
            @for (option of displayCountOptions; track option) {
              <option [value]="option">{{ option }} câu</option>
            }
          </select>
        </div>

        <!-- Font Selection Dropdown -->
        <div class="filter-group">
          <label for="fontSelect" class="filter-label">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <text x="2" y="15" font-size="14" font-weight="bold" fill="currentColor">A</text>
            </svg>
            Font chữ
          </label>
          <select 
            id="fontSelect"
            class="filter-select"
            data-testid="font-selector"
            [ngModel]="selectedFont()"
            (ngModelChange)="onFontChange($event)"
            aria-label="Chọn font chữ">
            @for (font of fontOptions; track font.value) {
              <option [value]="font.value">{{ font.label }}</option>
            }
          </select>
        </div>
      </div>
      
      <div class="search-bar">
        <div class="search-input-wrapper">
          <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
            <circle cx="9" cy="9" r="6" stroke="currentColor" stroke-width="2"/>
            <path d="M14 14l4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <input
            type="text"
            class="search-input"
            data-testid="search-input"
            placeholder="Tìm kiếm theo nội dung, tác giả hoặc danh mục..."
            [value]="searchQuery()"
            (input)="onSearchChange($any($event.target).value)"
            aria-label="Tìm kiếm câu trích dẫn"
          />
          @if (searchQuery()) {
            <button 
              class="clear-button"
              data-testid="clear-search"
              (click)="clearSearch()"
              aria-label="Xóa tìm kiếm"
              type="button">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          }
        </div>
      </div>
    </div>

    <!-- Grid Results -->
    @if (filteredQuotes().length === 0) {
      <div class="empty-state" data-testid="no-results">
        <svg class="empty-icon" width="64" height="64" viewBox="0 0 64 64" fill="none">
          <circle cx="32" cy="32" r="30" stroke="currentColor" stroke-width="2" opacity="0.3"/>
          <path d="M20 28h24M20 36h16" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity="0.3"/>
        </svg>
        <p class="empty-text">Không tìm thấy câu trích dẫn nào</p>
        <button class="clear-search-button" (click)="clearSearch()">
          Xóa tìm kiếm
        </button>
      </div>
    } @else {
      <div class="quote-grid" data-testid="quote-grid">
        @for (quote of filteredQuotes(); track quote.id) {
          <div class="grid-item">
            <app-quote-card [quote]="quote"></app-quote-card>
          </div>
        }
      </div>
    }
  }
</div>
